/* add by zongchunli 本程序用于将RTMP PACKET BUFFER中的数据进行缓冲，正确发送给服务器*/#include <stdio.h>#include <stdlib.h>#include <pthread.h>#include <time.h>#include "rtmp.h"#include "rtmp_sys.h"#include "thread.h"#define MAX_DELAY 10000 //最大延迟 10 秒//缓冲区管理/*分配缓冲区*/RTMPBuffer* RTMP_Alloc_Buffer();/*初始化缓冲区*/int RTMP_Init_Buffer(RTMPBuffer *pBuffer);/*释放缓冲区*/int RTMP_Free_Buffer(RTMPBuffer *pBuffer);/*给buffer node分配空间*/RTMPBuffer_Node* RTMP_Alloc_BufferNode();int RTMP_Free_BufferNode(RTMPBuffer_Node *pNode);/*将packet放入buffer中*/int RTMP_Put_Buffer(RTMPBuffer *pBuffer,RTMPPacket *pPacket, int iKeyFrame);/*从buffer中读取一个packet*/RTMPBuffer_Node* RTMP_Get_Buffer(RTMPBuffer *pBuffer);/*释放buffer中存放SPS,PPS数据的内存*/int RTMP_Free_SPS_PPS(RTMP_SPS_PPS *pSPSPPS);uint32_t RTMP_Get_Last_Time(RTMPBuffer *pBuffer);int RTMP_Send_Sequence(RTMP *pRtmp,RTMPBuffer *pBuffer,uint32_t iTime);int InitBufferConfig(BufferConfig *pConfig,int max_delay,int wait_time,int discard_type,int send_window,int retrytime);void FreeBufferConfig(BufferConfig *pConfig);void SetBufferStartTime(BufferConfig *pConfig);int GetBufferCurrentTime(BufferConfig *pConfig);